package ${package.controller};
#if($controllerFrameworkPkg.size()>0)

#end
#foreach($pkg in ${controllerFrameworkPkg})
import ${pkg};
#end
#if($controllerJavaPkg.size()>0)

#end
#foreach($pkg in ${controllerJavaPkg})
import ${pkg};
#end

/**
 * $!{table.comment} 前端控制器
 *
 * @author ${author}
#if(${docLink})
 * @see ${class.entity}
 * @see ${class.mapper}
 * @see ${class.serviceImpl}
#end
 * @since ${date}
 */
#if(${swagger3})
@Tag(name= "$!{table.comment}-前端控制器", description = "$!{table.comment}-前端控制器")
#elseif(${swagger2})
@Api(tags = "$!{table.comment}")
#end
#if(${crossOrigin})
@CrossOrigin
#end
#if(${restController})
@RestController
#else
@Controller
#end
#if(${lombok})
@RequiredArgsConstructor
#end
@RequestMapping("$!{requestBaseUrl}")
#if(${controllerSuperClass})
public class ${controller} extends ${controllerSuperClass} {
#else
public class ${controller} {
#end

    private final ${baseService} baseService;
#if(!${lombok})

    public ${controller}(${baseService} baseService) {
        this.baseService = baseService;
    }
#end
#if(${generateQuery})

    #if(${swagger3})
    @Operation(summary = "根据id查询详情")
    #elseif(${swagger2})
    @ApiOperation(value = "根据id查询详情")
    #else
    /**
     * 根据id查询详情
     *
     * @param id 主键id
     * @return 查询结果
     */
    #end
    #if(${restful})
    @GetMapping("$!{idPathParams}")
    #else
    @GetMapping("/select$!{idPathParams}")
    #end
    #if(!${restController})
    @ResponseBody
    #end
    public ${returnMethod.returnGenericTypeStr("${queryVO}")} id($!{idMethodParams}${primaryKeyPropertyType} id) {
        return ${returnMethod.invokeMethodStr("baseService.voById(id)")};
    }

    #if(${swagger3})
    @Operation(summary = "列表查询")
    #elseif(${swagger2})
    @ApiOperation(value = "列表查询")
    #else
    /**
     * 列表查询
     *
     * @param queryDTO 查询条件
     * @return 查询结果
     */
    #end
    ${batchQueryMethod}("/list")
    #if(!${restController})
    @ResponseBody
    #end
    public ${returnMethod.returnGenericTypeStr("List<${queryVO}>")} list($!{optionalBodyStr}${queryDTO} queryDTO) {
        #if($sqlBooster)
        SqlContext<SysUser> build = SqlBuilder.of(baseService).appendEqByBean(queryDTO).build();
        return ${returnMethod.invokeMethodStr("baseService.voList(build)")};    
        #else
        return ${returnMethod.invokeMethodStr("baseService.voList(queryDTO)")};
        #end
    }
    #if(${sqlBooster})

    #if(${swagger3})
    @Operation(summary = "列表查询-动态条件")
    #elseif(${swagger2})
    @ApiOperation(value = "列表查询-动态条件")
    #else
    /**
     * 列表查询-动态条件
     *
     * @param sqlHelper 条件构造器
     * @return 查询结果
     */
    #end
    @PostMapping("/advanced/list")
    #if(!${restController})
    @ResponseBody
    #end
    public ${returnMethod.returnGenericTypeStr("List<${queryVO}>")} advancedList($!{optionalBodyStr}SqlContext<${entity}> sqlContext) {
        return ${returnMethod.invokeMethodStr("baseService.voList(sqlContext)")};
    }
    #end

    #if(${swagger3})
    @Operation(summary = "分页查询")
    #elseif(${swagger2})
    @ApiOperation(value = "分页查询")
    #else
    /**
     * 分页查询
     *
     * @param queryDTO 查询条件
     * @param current 页码
     * @param size 每页大小
     * @return 查询结果
     */
    #end
    ${batchQueryMethod}("/page$!{pagePathParams}")
    #if(!${restController})
    @ResponseBody
    #end
    public ${returnMethod.returnGenericTypeStr(${pageReturnType})} page($!{optionalBodyStr}${queryDTO} queryDTO, $!{pageMethodParams}) {
        #if($sqlBooster)
        SqlContext<SysUser> build = SqlBuilder.of(baseService).appendEqByBean(queryDTO).build();
        return ${returnMethod.invokeMethodStr(${pageMethod.invokeMethodStr("baseService.voPage(build, current, size)")})};
        #else
        return ${returnMethod.invokeMethodStr(${pageMethod.invokeMethodStr("baseService.voPage(queryDTO, current, size)")})};
        #end
    }

    #if(${sqlBooster})

    #if(${swagger3})
    @Operation(summary = "分页查询-动态条件")
    #elseif(${swagger2})
    @ApiOperation(value = "分页查询-动态条件")
    #else
    /**
     * 分页查询-动态条件
     *
     * @param sqlContext 条件构造器
     * @param current 页码
     * @param size 每页大小
     * @return 查询结果
     */
    #end
    @PostMapping("/advanced/page$!{pagePathParams}")
    #if(!${restController})
    @ResponseBody
    #end
    public ${returnMethod.returnGenericTypeStr(${pageReturnType})} advancedPage($!{optionalBodyStr}SqlContext<${entity}> sqlContext, $!{pageMethodParams}) {
        return ${returnMethod.invokeMethodStr(${pageMethod.invokeMethodStr("baseService.voPage(sqlContext, current, size)")})};
    }
    #end
#end
#if(${generateCreate})

    #if(${swagger3})
    @Operation(summary = "新增")
    #elseif(${swagger2})
    @ApiOperation(value = "新增")
    #else
    /**
     * 新增
     *
     * @param createDTO 新增入参对象
     * @return 新增后的数据id
     */
    #end
    #if(${restful})
    @PostMapping("")
    #else
    @PostMapping("/create")
    #end
    #if(!${restController})
    @ResponseBody
    #end
    public ${returnMethod.returnGenericTypeStr("Serializable")} create($!{requiredBodyStr}$!{validatedStr}${createDTO} createDTO) {
        return ${returnMethod.invokeMethodStr("baseService.createByDTO(createDTO)")};
    }
#end
#if(${generateUpdate})

    #if(${swagger3})
    @Operation(summary = "修改")
    #elseif(${swagger2})
    @ApiOperation(value = "修改")
    #else
    /**
     * 修改
     *
     * @param updateDTO 修改入参对象
     * @return 是否成功
     */
    #end
    #if(${restful})
    @PutMapping("")
    #else
    @PostMapping("/update")
    #end
    #if(!${restController})
    @ResponseBody
    #end
    public ${returnMethod.returnGenericTypeStr("Boolean")} update($!{requiredBodyStr}$!{validatedStr}${updateDTO} updateDTO) {
        return ${returnMethod.invokeMethodStr("baseService.updateByDTO(updateDTO)")};
    }
#end
#if(${generateDelete})

    #if(${swagger3})
    @Operation(summary = "删除")
    #elseif(${swagger2})
    @ApiOperation(value = "删除")
    #else
    /**
     * 根据id删除
     *
     * @param id 主键id
     * @return 是否成功
     */
    #end
    #if(${restful})
    @DeleteMapping("$!{idPathParams}")
    #else
    @PostMapping("/delete$!{idPathParams}")
    #end
    #if(!${restController})
    @ResponseBody
    #end
    public ${returnMethod.returnGenericTypeStr("Boolean")} delete($!{idMethodParams}${primaryKeyPropertyType} id) {
        return ${returnMethod.invokeMethodStr("baseService.removeById(id)")};
    }
#end
#if(${generateImport})

    #if(${swagger3})
    @Operation(summary = "下载excel导入模板")
    #elseif(${swagger2})
    @ApiOperation(value = "下载excel导入模板")
    #else
    /**
     * 下载excel导入模板
     */
    #end
    @GetMapping("/excel/template")
    public void excelTemplate(HttpServletResponse response) throws IOException {
        response.setContentType("application/vnd.ms-excel");
##        response.setHeader("Access-Control-Expose-Headers", "Content-Disposition");
        response.setHeader("Content-Disposition", "attachment;filename=" + System.currentTimeMillis() + ".xlsx");
        baseService.excelTemplate(response.getOutputStream());
    }

    #if(${swagger3})
    @Operation(summary = "excel文件导入")
    #elseif(${swagger2})
    @ApiOperation(value = "excel文件导入")
    #else
    /**
     * excel文件导入
     *
     * @param excel excel文件
     * @return 导入条数
     */
    #end
    @PostMapping("/excel/import")
    #if(!${restController})
    @ResponseBody
    #end
    public ${returnMethod.returnGenericTypeStr("Integer")} excelImport(@RequestParam("excel") MultipartFile excel) throws IOException {
        if (excel == null || excel.isEmpty()) return ${returnMethod.invokeMethodStr(0)};
        return ${returnMethod.invokeMethodStr("baseService.excelImport(excel.getInputStream())")};
    }
#end
#if(${generateExport})

    #if(${swagger3})
    @Operation(summary = "excel文件导出")
    #elseif(${swagger2})
    @ApiOperation(value = "excel文件导出")
    #else
    /**
     * excel文件导出
     * 
     * @param queryDTO 查询条件
     */
    #end
    ${batchQueryMethod}("/excel/export")
    public void excelExport($!{optionalBodyStr}${queryDTO} queryDTO, HttpServletResponse response) throws IOException {
        response.setContentType("application/vnd.ms-excel");
##        response.setHeader("Access-Control-Expose-Headers", "Content-Disposition");
        response.setHeader("Content-Disposition", "attachment;filename=" + System.currentTimeMillis() + ".xlsx");
        #if($sqlBooster)
        SqlContext<SysUser> build = SqlBuilder.of(baseService).appendEqByBean(queryDTO).build();
        baseService.excelExport(build, response.getOutputStream());
        #else
        baseService.excelExport(queryDTO, response.getOutputStream());
        #end
    }
    #if(${sqlBooster})

    #if(${swagger3})
    @Operation(summary = "excel文件导出-动态条件")
    #elseif(${swagger2})
    @ApiOperation(value = "excel文件导出-动态条件")
    #else
    /**
     * excel文件导出-动态条件
     * 
     * @param sqlContext 条件构造器
     */
    #end
    @PostMapping("/advanced/excel/export/booster")
    public void advancedExcelExport($!{optionalBodyStr}SqlContext<${entity}> sqlContext, HttpServletResponse response) throws IOException {
        response.setContentType("application/vnd.ms-excel");
##        response.setHeader("Access-Control-Expose-Headers", "Content-Disposition");
        response.setHeader("Content-Disposition", "attachment;filename=" + System.currentTimeMillis() + ".xlsx");
        baseService.excelExport(sqlContext, response.getOutputStream());
    }
    #end
#end
}