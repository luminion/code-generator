package ${package.serviceImpl};
#if($serviceImplImportPackages4Framework.size()>0)

#end
#foreach($pkg in ${serviceImplImportPackages4Framework})
import ${pkg};
#end
#if($serviceImplImportPackages4Java.size()>0)

#end
#foreach($pkg in ${serviceImplImportPackages4Java})
import ${pkg};
#end

/**
 * $!{table.comment} 服务实现类
 *
 * @author ${docAuthor}
 * @since ${docDate}
 */
@Service
#if(${generate.service})
public class ${serviceImpl} extends ${superServiceImplClass}<${mapper}, ${entity}> implements ${service} {
#else
public class ${serviceImpl} extends ${superServiceImplClass}<${mapper}, ${entity}> {
#end
#if(${generateQuery})

    #if(${generate.service})
    @Override
    #end
    public ${queryVO} voById(Serializable id) { 
        #if(${table.primaryKeyField})
        ${queryDTO} queryDTO = new ${queryDTO}()
        queryDTO.set${table.primaryKeyField.capitalName}((${table.primaryKeyField.propertyType})id);
        return this.voList(queryDTO).stream().findFirst().orElse(null);
        #else
        throw new IllegalStateException("can't find id property");
        #end
    }

    #if(${generate.service})
    @Override
    #end
    public List<${queryVO}> voList(${queryDTO} queryDTO) {
        return getBaseMapper().selectByXml(queryDTO, null);
    }

    #if(${generate.service})
    @Override
    #end
    public IPage<${queryVO}> voPage(${queryDTO} queryDTO, long current, long size) {
        Page<${queryVO}> page = new Page<>(current, size);
        List<${queryVO}> voList = getBaseMapper().selectByXml(queryDTO, page);
        page.setRecords(voList);
        return page;
    }
#end
#if(${generateInsert})

    #if(${generate.service})
    @Override
    #end
    public Serializable insertByDTO(${insertDTO} insertDTO) {
        ${entity} entity = new ${entity}();
        BeanUtils.copyProperties(insertDTO, entity);
        super.save(entity);
        #if(${table.primaryKeyField})
        return entity.get${table.primaryKeyField.capitalName}();
        #else
        return null;
        #end
    }
#end
#if(${generateUpdate})

    #if(${generate.service})
    @Override
    #end
    public boolean updateByDTO(${updateDTO} updateDTO) {
        ${entity} entity = new ${entity}();
        BeanUtils.copyProperties(updateDTO, entity);
        return super.updateById(entity);
    }
#end
#if(${generateDelete})

    @Override
    public boolean removeById(Serializable id) {
        #if(${table.primaryKeyField})
        return super.removeById(id);
        #else
        throw new IllegalStateException("can't find id property");
        #end
    }
#end
#if(${generateImport})

    #if(${generate.service})
    @Override
    #end
    public void excelTemplate(OutputStream os) {
        ${excelApiClass}.write(os, ${class.excelImportDTO}).sheet().doWrite(Collections.emptyList());
    }

    #if(${generate.service})
    @Override
    #end
    public int excelImport(InputStream is) {
        List<${excelImportDTO}> dataList = ${excelApiClass}.read(is).head(${class.excelImportDTO}).sheet().doReadSync();
        List<${entity}> entityList = dataList.stream().map(excelImportDTO -> {
            ${entity} entity = new ${entity}();
            BeanUtils.copyProperties(excelImportDTO, entity);
            return entity;
        }).collect(Collectors.toList());
        super.saveBatch(entityList);
        return entityList.size();
    }
#end
#if(${generateExport})

    #if(${generate.service})
    @Override
    #end
    public void excelExport(${queryDTO} queryDTO, OutputStream os) {
        ${excelApiClass}.write(os, ${class.excelExportDTO}).sheet().doWrite(this.voList(queryDTO));
    }
#end
}
